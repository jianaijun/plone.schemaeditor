<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
>

<head tal:define="portal_url context/@@plone_portal_state/portal_url">
<style type="text/css" media="screen">
    #modelEditor {
        position: absolute;
        top: 100px;
        right: 2%;
        bottom: 2%;
        left:1%;
        border: 1px solid black;
    }
</style>


<script src="++resource++plone.app.jquery.js"
    type="text/javascript"
    tal:attributes="src string:${portal_url}/++resource++plone.app.jquery.js"
    ></script>
<script src="++resource++plone.resourceeditor/ace/ace.js"
    type="text/javascript"
    charset="utf-8"
    tal:attributes="src string:${portal_url}/++resource++plone.resourceeditor/ace/ace.js"
    ></script>

<script type="text/javascript">
    jQuery(function ($) {
        var editor = ace.edit("modelEditor"),
            session = editor.getSession(),
            commands = editor.commands;
        editor.setTheme("ace/theme/textmate");
        session.setMode("ace/mode/xml");
        session.setTabSize(4);
        session.setUseSoftTabs(true);
        session.setUseWrapMode(true);
        editor.setHighlightActiveLine(false);

        commands.addCommand({
            name: "save",
            bindKey: {win: "Ctrl-S", mac: "Command-S"},
            exec: function() {
                $('#saveform').submit();
            }
        });

        session.on('change', function(e) {
            $('#saveform :submit').removeAttr('disabled');
        });

        $( "#saveform" ).on( "submit", function( event ) {
            event.preventDefault();
            alert("Fake Save File");
            console.log( $(this).serialize() );
            $('#saveform :submit').attr('disabled', 'disabled');
        });
    });
</script>


</head>

<body>
<div  class="documentEditable" >

    <div metal:use-macro="context/global_statusmessage/macros/portal_message">
      Portal status message
    </div>

    <form id="saveform" tal:define="authenticator context/@@authenticator/authenticator | nothing">
        <input tal:replace="structure authenticator" />
        <input type="hidden" id="savesource" name="source" value="" />
        <div class="formControls">
            <input class="context" type="submit" name="form.button.save" value="Save" disabled="disabled" />
        </div>

    </form>

    <div id="content">
        <div id="modelEditor" tal:content="view/modelSource" />
    </div>

</div>


<script type="text/javascript">
</script>

</body>
</html>
